import time
import os
from google.cloud import pubsub_v1

import requests
import csv

import datetime
import numpy as np
from yahoo_earnings_calendar import YahooEarningsCalendar


project_id = "kaggle-playground-170215"

os.environ["GOOGLE_APPLICATION_CREDENTIALS"]="/Users/goldbloom/Dropbox/Side Projects/Edgar/Key/kaggle-playground-0f760ec0ebcd.json"

def fetch_ticker_list(list_name='sample_list'): 
    
    if list_name == 'all_tickers':
       ticker_list = get_all_tickers() 
    elif list_name == 'earnings_today':
       ticker_list = get_todays_earnings()
    elif list_name == 'sp500':
        ticker_list = ['MMM',	'ABT',	'ABBV',	'ABMD',	'ACN',	'ATVI',	'ADBE',	'AMD',	'AAP',	'AES',	'AFL',	'A',	'APD',	'AKAM',	'ALK',	'ALB',	'ARE',	'ALXN',	'ALGN',	'ALLE',	'LNT',	'ALL',	'GOOGL',	'GOOG',	'MO',	'AMZN',	'AMCR',	'AEE',	'AAL',	'AEP',	'AXP',	'AIG',	'AMT',	'AWK',	'AMP',	'ABC',	'AME',	'AMGN',	'APH',	'ADI',	'ANSS',	'ANTM',	'AON',	'AOS',	'APA',	'AIV',	'AAPL',	'AMAT',	'APTV',	'ADM',	'ANET',	'AJG',	'AIZ',	'T',	'ATO',	'ADSK',	'ADP',	'AZO',	'AVB',	'AVY',	'BKR',	'BLL',	'BAC',	'BK',	'BAX',	'BDX',	'BRK.B',	'BBY',	'BIO',	'BIIB',	'BLK',	'BA',	'BKNG',	'BWA',	'BXP',	'BSX',	'BMY',	'AVGO',	'BR',	'BF.B',	'CHRW',	'COG',	'CDNS',	'CPB',	'COF',	'CAH',	'KMX',	'CCL',	'CARR',	'CAT',	'CBOE',	'CBRE',	'CDW',	'CE',	'CNC',	'CNP',	'CTL',	'CERN',	'CF',	'SCHW',	'CHTR',	'CVX',	'CMG',	'CB',	'CHD',	'CI',	'CINF',	'CTAS',	'CSCO',	'C',	'CFG',	'CTXS',	'CLX',	'CME',	'CMS',	'KO',	'CTSH',	'CL',	'CMCSA',	'CMA',	'CAG',	'CXO',	'COP',	'ED',	'STZ',	'COO',	'CPRT',	'GLW',	'CTVA',	'COST',	'COTY',	'CCI',	'CSX',	'CMI',	'CVS',	'DHI',	'DHR',	'DRI',	'DVA',	'DE',	'DAL',	'XRAY',	'DVN',	'DXCM',	'FANG',	'DLR',	'DFS',	'DISCA',	'DISCK',	'DISH',	'DG',	'DLTR',	'D',	'DPZ',	'DOV',	'DOW',	'DTE',	'DUK',	'DRE',	'DD',	'DXC',	'ETFC',	'EMN',	'ETN',	'EBAY',	'ECL',	'EIX',	'EW',	'EA',	'EMR',	'ETR',	'EOG',	'EFX',	'EQIX',	'EQR',	'ESS',	'EL',	'EVRG',	'ES',	'RE',	'EXC',	'EXPE',	'EXPD',	'EXR',	'XOM',	'FFIV',	'FB',	'FAST',	'FRT',	'FDX',	'FIS',	'FITB',	'FE',	'FRC',	'FISV',	'FLT',	'FLIR',	'FLS',	'FMC',	'F',	'FTNT',	'FTV',	'FBHS',	'FOXA',	'FOX',	'BEN',	'FCX',	'GPS',	'GRMN',	'IT',	'GD',	'GE',	'GIS',	'GM',	'GPC',	'GILD',	'GL',	'GPN',	'GS',	'GWW',	'HRB',	'HAL',	'HBI',	'HIG',	'HAS',	'HCA',	'PEAK',	'HSIC',	'HSY',	'HES',	'HPE',	'HLT',	'HFC',	'HOLX',	'HD',	'HON',	'HRL',	'HST',	'HWM',	'HPQ',	'HUM',	'HBAN',	'HII',	'IEX',	'IDXX',	'INFO',	'ITW',	'ILMN',	'INCY',	'IR',	'INTC',	'ICE',	'IBM',	'IP',	'IPG',	'IFF',	'INTU',	'ISRG',	'IVZ',	'IPGP',	'IQV',	'IRM',	'JKHY',	'J',	'JBHT',	'SJM',	'JNJ',	'JCI',	'JPM',	'JNPR',	'KSU',	'K',	'KEY',	'KEYS',	'KMB',	'KIM',	'KMI',	'KLAC',	'KSS',	'KHC',	'KR',	'LB',	'LHX',	'LH',	'LRCX',	'LW',	'LVS',	'LEG',	'LDOS',	'LEN',	'LLY',	'LNC',	'LIN',	'LYV',	'LKQ',	'LMT',	'L',	'LOW',	'LYB',	'MTB',	'MRO',	'MPC',	'MKTX',	'MAR',	'MMC',	'MLM',	'MAS',	'MA',	'MKC',	'MXIM',	'MCD',	'MCK',	'MDT',	'MRK',	'MET',	'MTD',	'MGM',	'MCHP',	'MU',	'MSFT',	'MAA',	'MHK',	'TAP',	'MDLZ',	'MNST',	'MCO',	'MS',	'MOS',	'MSI',	'MSCI',	'MYL',	'NDAQ',	'NOV',	'NTAP',	'NFLX',	'NWL',	'NEM',	'NWSA',	'NWS',	'NEE',	'NLSN',	'NKE',	'NI',	'NBL',	'NSC',	'NTRS',	'NOC',	'NLOK',	'NCLH',	'NRG',	'NUE',	'NVDA',	'NVR',	'ORLY',	'OXY',	'ODFL',	'OMC',	'OKE',	'ORCL',	'OTIS',	'PCAR',	'PKG',	'PH',	'PAYX',	'PAYC',	'PYPL',	'PNR',	'PBCT',	'PEP',	'PKI',	'PRGO',	'PFE',	'PM',	'PSX',	'PNW',	'PXD',	'PNC',	'PPG',	'PPL',	'PFG',	'PG',	'PGR',	'PLD',	'PRU',	'PEG',	'PSA',	'PHM',	'PVH',	'QRVO',	'PWR',	'QCOM',	'DGX',	'RL',	'RJF',	'RTX',	'O',	'REG',	'REGN',	'RF',	'RSG',	'RMD',	'RHI',	'ROK',	'ROL',	'ROP',	'ROST',	'RCL',	'SPGI',	'CRM',	'SBAC',	'SLB',	'STX',	'SEE',	'SRE',	'NOW',	'SHW',	'SPG',	'SWKS',	'SLG',	'SNA',	'SO',	'LUV',	'SWK',	'SBUX',	'STT',	'STE',	'SYK',	'SIVB',	'SYF',	'SNPS',	'SYY',	'TMUS',	'TROW',	'TTWO',	'TPR',	'TGT',	'TEL',	'FTI',	'TDY',	'TFX',	'TXN',	'TXT',	'TMO',	'TIF',	'TJX',	'TSCO',	'TT',	'TDG',	'TRV',	'TFC',	'TWTR',	'TYL',	'TSN',	'UDR',	'ULTA',	'USB',	'UAA',	'UA',	'UNP',	'UAL',	'UNH',	'UPS',	'URI',	'UHS',	'UNM',	'VFC',	'VLO',	'VAR',	'VTR',	'VRSN',	'VRSK',	'VZ',	'VRTX',	'VIAC',	'V',	'VNO',	'VMC',	'WRB',	'WAB',	'WMT',	'WBA',	'DIS',	'WM',	'WAT',	'WEC',	'WFC',	'WELL',	'WST',	'WDC',	'WU',	'WRK',	'WY',	'WHR',	'WMB',	'WLTW',	'WYNN',	'XEL',	'XRX',	'XLNX',	'XYL',	'YUM',	'ZBRA',	'ZBH',	'ZION',	'ZTS']
    elif list_name == 'sample_list':
        ticker_list = ['MSFT','AMZN','NVDA','ORCL','INTC','CRM','TSLA','FB','AAPL','NFLX','ZM','ZEN','ADBE','UBER','LYFT','ZG','WORK','OKTA','BYND','GOOG']
        #ticker_list = ['AAPL','AXP','BA','CAT','CSCO','CVX','DD','DIS','GE','GS','HD','IBM','INTC','JNJ','JPM','KO','MCD','MMM','MRK','MSFT','NKE','PFE','PG','TRV','UNH','UTX','V','VZ']
        #ticker_list = ['WMT','XOM']
    elif list_name == 'debug':
        ticker_list = ['HYAS']

    return ticker_list 

                    
def get_all_tickers():
    resp = requests.get('https://www.sec.gov/include/ticker.txt')
    ticker_cik_text = resp.content.decode('utf-8')
    ticker_cik_list = list(csv.reader(ticker_cik_text.splitlines(), delimiter='\t'))
    
    ticker_list = []
    for item in ticker_cik_list:
        ticker_list.append(item[0].upper())

    return ticker_list

def get_todays_earnings():
    today = datetime.date.today()
    date_from = datetime.datetime.combine(today, datetime.datetime.min.time())
    date_to = datetime.datetime.combine(today, datetime.datetime.max.time())

    yec = YahooEarningsCalendar()
    earnings_list = yec.earnings_between(date_from, date_to)

    ticker_list = []
    for stock in earnings_list:
        ticker_list.append(stock['ticker'])
    
    return np.unique(ticker_list)

ticker_list = ['DPZ','TBK','MEI','BLNC','IPIC','IPICQ','FOR','NVIV','GS-PN','QLYS','HIG','LFER','MNR','PSA-PG','ICCC','SFHI','BIEI','PGNX','FSI','DUKB','MDEX','CHK','BMRA','TFC-PO','MBOT','STBA','STZ','ARGS','NGM','MTEX','RVLT','EMAN','AFGD','USB-PM','SSOK','STAG-PC','DISCK','ROKR','MPC','CSUI','PGTK','GPRE','CDZI','NBLX','FHN-PA','CKH','DLR-PC','HSTM','ANDR','OCC','FLUX','ANAV','CSTR','CACC','GADS','GTX','OEG','XBIOW','FREJN','NGTF','TBBK','SF-PB','TRVI','SEEL','TURV','AMRX','BHCV','COWN','NUE','NCMI','THFF','CDTI','WINT','TSN','SAL','IRWD','NURO','AYRO','CAPR','HBAN','MITL','RNR','CPB','PSA-PV','RNVAW','DNKN','BK-PC','GBL','BXP','CNLHN','AGM-PD','CWH','ARDX','ATNX','IMAHF','TDW','ARQL','TRNS','CNMF','CXDC','OBCI','WRB-PE','WINR','WRLSU','NTOX','WU','GLG','PCO','DDLX','AROC','TMUS','INR','STFC','TACOW','INBKZ','PDCE','CAPL','NTAP','CGNX','DRQ','EXEL','AGGX','CCRN','GCAN','CWK','GEF','DTEA','ONDR','GBTC','GGROU','CWRK','COMS','SOJD','REGN','NYCB-PA','CNP','UMH-PC','IBTGF','RYN','INLB','LVGO','SMCI','TMHC','GLL','HIG-PG','DLR-PG','WWW','JMDAD','LFACU','HAWLM','REXR','ASPU','AEGN','JSMM','OFLX','SCTY','KDOZF','QSMG','FNMAT','BMTM','DPW','NWHM','MU','LM','CLI','BRK-B','AIN','BBGI','BOJA','IDN','AIM','CHCR','NAHD','RNVAD','BRK-A','EUFX','CLB','MMNT','NRIS','HBANO','IGXT','FICO','SASR','VNUE','PGNY','INAPQ','AAGH','CHDN','BEGI','BFS-PE','GENH','PLBC','DNXG','ESP','CENX','XSPA','AFHBL','STXB','NNN-PF','CGYG','QEP','ABTX','FRLG','GNSS','XEC','CTEK','BBLG','WSTL','FMTX','WBS','AXPWQ','UIS','GFTX','MKTY','VECO','NG','EVIO','GRBK','VNO-PL','AGNCO','TFC-PR','STT','RGA','AOXY','UEPS','NWPX','RGNPD','GPI','FISI','ZSL','SNRG','DYNR','ADHG','CFX','SYN','ZNWAA','DISCA','RRTS','TCX','EAF','USWS','COF-PI','CHFN','FTNW','PCSA','EWST','TLRS','FVCB','IEHC','AVYA','GEF-B','HMST','KONAQ','BRLI','PMT-PA','CTB','SMTA','COF-PG','WINRW','LOACW','ES','ESS','ADS','BKH','CBDY','GPJA','ANIX','FMCCS','OFG-PD','NSPR-WTB','ACRS','NPO','NIMU','FRFR','LKAI','CTA-PA','WNDW','GS-PC','BELFB','AMWD','KIM-PM','AKRO','PSIX','TWNK','TVMD','PLXS','BUDZ','JIH','CHMD','CNDT','EAT','ORMP','APRDN','OXFD','PCG','CULP','AFG','WRLSW','GBLX','BK','ASYS','OFG-PA','RMD','EGP','FMBM','LANC','HRSTD','EYE','AXS-PE','PECKW','KNIT','PPLT','MINI','AUBAP','BIG','RDGL','LII','SHSP','CRWE','CCBG','CPOW','GBT','WTFCM','SENS','SPXC','ATHX','CCH-WT','PRSI','GS-PJ','MYE','ISBA','ACRGF','WABC','URBN','AVXL','TTCM','RGEN','MUR','HVBC','NGVT','HAWEL','FIZZ','MDC','RCP','PHIO','BXS','PWCO','AIG-WT','FRAF','TEAR','BLUE','PRTT','VSTM','PSA-PD','IMACW','UNGS','BMIX','SWN','GPAQW','AIVN','DSSI','MTRN','POLA','BFAM','VIVO','PSN','HCHC','SRE','VNO','PWVI','DBCP','GDP','CREE','ROSEW','SYKE','UBIA','THRM','GIS','PJT','GBLI','ENBP','ELST','BG','CCK','CHKVP','CACI','IHT','LCHD','BLNK','TTOO','KINS','FRED','PVAC','FLO','SGSI','RGSEQ','RYAM','XLNX','LB','CJJD','THM','PETQ','HPGN','TNRG','APO-PB','GIGA','SUI','DCAR','THO','ENS','NGRP','BOKF','HRI','VRMEW','AGNCP','FN','CNP-PB','BATL','NSPR-WT','VRME','FC','FFKT','PMT-PB','LFAC','VBIV','CATM','FHRT','CTAS','AVGOP','BRQS','MLR','WSO','CIT','ETN','APO','FMCKK','ROP','ATTP','ZAGG','WRB-PF','ITRI','JEC','ATLO','BANM','KRED','SMPL','PPBI','RH','INSW-PA','CHKDP','SBCF','FSFG','ALL-PG','RWLK','PCG-PE','NGHC','LBTYK','ASDN','BURL','BLBD','BHBK','GBGD','TPHS','EPD','DESTQ','EFC-PA','AIRI','PRPH','CAPD','INTV','AVCTW','OTTR','PCG-PG','MGTX','ASB-PC','AMN','DTP','NGL-PB','MLVF','VRUS','HAWLI','DCP-PB','FNB','SIVBP','SURF','ALBO','ATMO','AYTU','FNHI','DRSV','IFMK','USB-PA','ZG','MAN','FCE-A','SVRA','TBB','FMCKP','UMH-PB','ARCW','EMBI','AM','FVRG','LIVE','CSX','WPG','ADTX','CZNI','DTY','HCGS','FITBP','AMBC','WLL','FNMAP','AMRWW','PTLA','CVGI','BPMC','MYSZ','LNCE','TRXO','ARE','AEO','RBCAA','CBAY','CUBI-PE','NGLS-PA','PNRG','MET-PA','GE','CMFT','GS-PK','NYMTP','COHR','JBSS','GFNL','KFY','PRK','MSM','GCC','CTAM','LAMR','MICT','MRO','SYEV','BX','AYTUZ','REXR-PA','NYMTN','OSAT','HTLFP','AAP','KWBT','PATI','PTOI','ALLY-PA','AKS','ROSUQ','CMGO','FOMX','AEIS','CXDO','CRNX','VPG','SMHI','TMP','GEC','LLIT','TLRY','MLP','TGLS','TBPH','PRGX','PUBC','BOIL','NTWK','BLNKW','DARE','GBCI','CASM','ECOS','QCOM','GHM','WVFC','CUK','CWT','DCOM','DLTR','FUSB','RPAYW','DGII','TBC','IAU','PHBR','AMTY','WEIN','INPX','UGL','NRTSF','SGIL','BRMT','COOP','LDL','SIGN','COLD','HBIO','BVH','MJCO','PMT','IEC','PPSI','MCCX','SCHS','SOAN','RTLR','ENZ','ICON','NRZ-PA','AMAG','CMXC','VIVE','APRCP','HZNP','SEII','FARM','UWHR','IFNY','HCRSQ','QBAK','GEIN','SWCH','NGVC','ALPVN','TREX','HCR','VNO-PK','GFNCP','CRZO','USB-PP','MUGH','MLPY','HCCI','WCC','CCTC','TXCB','GLTC','SINT','LTRX','WW','FJHLD','CCOP','WRB','UMBF','UPLC','MICR','GAHC','NWBI','AMT','HRST','NPHC','IEP','ATLT','ALLY','TROX','EAST','SO','PRS','ABR-PB','AREB','ALRM','CABA','SKKY','ROSEU','SYBX','BFS-PD','TALR','ZDGE','CRWS','HOFV','PLMR','CPLG','SYNE','SNA','RACA','CFDB','SNYR','ATPT','RBB','VGR','JCAP','AMNB','AMPY','CNNC','NAUH','FLFG','UVE','STX','CTO','ATAX','UFI','WLDN','ATDS','PPC','MORN','SRG','EYEGW','PSA-PE','PBYA','CNXM','ABCE','NNN','NBIO','CCOB','USB-PH','JLL','TFC-PG','PQEFF','CLF','HTLF','MH-PD','GERN','PCG-PA','PBCT','WFTLF','SOYB','HROW','JILL','ACI','PNC','STRI','XONE','PAG','VAPO','PGC','BOTJ','LEN','CTVA','ENRT','REI','GLGI','JMPNZ','KODK','TPAC','RL','CNY','VABK','CIIT','ATRC','PRI','OWPC','HELE','ANTM','HP','ALIM','PLT','FINL','QRTEA','AUSI','GOCO','NLST','PSA-PL','MBII','KRNY','TMUSR','CCRE','BNKL','SOLN','DPLS','VLY','CHKDG','HPQ','CODI','SFORD','TFC','INMB','KRMD','CVMCA','HEPA','EQBK','COF-PF','PINC','VYGR','FGCO','LBTYB','CRAWA','RGBP','RNST','CELH','PLYM','GCP','DNLI','ANSS','LORL','FOGO','RISE','FMCKJ','BCOW','DBUB','SVXY','RVNC','O','TIER','ENDP','WPC','XBIO','NFBK','BWXT','SBES','TCFC','BTGI','BRLIR','FLCX','STAR','RPD','UGI','LQDA','VNO-PM','GRWG','NGHCZ','HDYNQ','BBLS','LJPC','AVCT','ZMDC','DLR-PI','NLY-PG','RGNP','BLXX','GH','FCX','HOFVW','MH-PC','CLIR','GNRSW','RNET','AMRB','CBNT','ATLS','USNA','LOCO','TNAV','RGCO','AGNCN','WK','RNR-PE','PLSB','SLG','PACB','FUTL','AFGB','LARK','GBPT','VALPQ','OTEX','TCBIP','FMCC','BBXTB','KEM','AMRWQ','PSX','USAU','ENSV','STCN','URSL','RFIL','AURM','REPH','SNV-PD','NES','AYTUW','AGFS','XSPT','BANC','FAF','VOYA-PB','CNOB','THR','ELS','FMCKL','FG-WT','COF-PJ','SIGA','LW','DD','TLRDQ','GRBX','HAWLN','CLX','BRKR','YEWB','BMSN','BKD','NLOK','PRXL','RFL','ACTG','CNX','GILD','AGYS','TXAC','NWGI','VXRT','FPFI','NEOS','ETCK','VAR','SPTN','CRON','ANCX','RMHB','PIH','BGCP','CNABQ','GNW','SDI','APRDO','GFMH','XDIV','ROG','SGSID','MVIS','CYS','OESX','BCEI','NJMC','REXR-PC','FPAY','RAYT','ADXS','DNB','LMHA','WEWA','QTMM','DIGP','KONA','SPND','NOVT','TANNI','ALAC','CG','MSSV','CSGP','ISRB','FMSA','VLRXQ','PLYZ','ALL-PB','DPHCU','YRIV','ARGD','BCO','PCG-PD','TACO','ORC','PSID','PRFT','INLX','TLRA','GBCS','UNT','PAVMW','RCRT','HTBK','NXEN','BRKS','CDNS','MORF','SCON','GPC','SCE-PD','IRM','NKLA','TDY','BIIB','JAX','MH-PA','RZB','CNIG','WG','LEAF','NSH','VBTX','CLNE','CORN','AGFSW','MET-PF','WRB-PC','HNNA','FEIM','DYN','SRC','BCRX','ISBC','IBKCN','ADTN','MS','PAYC','APTS','SIC','AIG','FMBH','BRID','VYEY','SC','FSB','CCB','PME','SSDT','CHCI','YUME','MDIT','EIGI','FREJO','KW','NRP','TENX','BDRY','PACK','ZYXI','CPF','ETAH','ENOB','LFERD','TAT','ACRX','SNFCA','GDRZF','SEE','UNG','CYDY','UMH-PD','GCE','CMC','UFS','PE','FEYE','NTRS','AAME','PK','SGBX','BANR','APPS','D','DLTI','FGEN','WOR','NLY','AVAV','KFS','CHKLQ','AFH','UBER','EDUC','ETFM','APXTU','AGNCM','DORM','AFGH','CFMS','BCBP','RSLS','DERM','EVI','UNTY','PGTI','AIRT','TER','MOS','ABR','LKQ','MSFT','GTE','FMCKN','REXX','RUN','CBSH','TWI','FREJP','TOL','TWO-PE','PCG-PH','KAYS','BUSE','PFC','GROG','TWO-PD','OILD','IHRT','GROW','OXY','CSBR','STON','ESGRO','CASY','LGL','LITH','HGH','AWI','APVO','KELYA','PARR','SRTSW','CUZ','VIR','PRPO','ABCB','OSMT','USB-PO','HR','BMMJ','ADES','SRRA','HWBK','SONS','DDD','GPK','MO','ROSEQ','NYCB-PU','HSON','CROC','TCMD','FMCCM','LBTYA','APD','RGRX','BGS','THMG','QNST','CANB','RSPP','NGL-PC','NHHS','PFE','PESXQ','EAWD','RSPI','CRKN','AMBC-WT','INTL','USWSW','INBK','ZIONL','UVXY','HE','TSCO','FITBI','ACFN','VIRT','TFSL','FMBIP','CODI-PB','BMSND','GLFH','ALL-PH','BXS-PA','ZDPY','LBAI','WRB-PB','PS','LNTH','PFGC','WEYL','CMRX','ABMD','ORI','FGP','NWS','CPE','TWO-PA','PLPC','ALJJ','APRDM','B','UCFC','ARDMQ','UCLE','PQG','SKT','AGRX','TLRD','GLLA','SRNA','AET','BRST','PCG-PC','APDN','IBOC','QUAD','IDTI','AGN','DAN','TVMDD','FHN-PE','UPWK','DVAX','MITI','CSWI','OLED','DMAC','TFC-PH','LBUY','TNTY','MET','GNRSU','REG','UNIR','NCOM','PECK','DZSI','EYPT','CHTR','AVHI','BRSF','UONEK','SOJC','MMTRS','SMIT','DLR','SFEG','ADP','SWKS','CLSD','NOVC','TECR','PBI-PB','WFBI','CATY','HII','BTTR','XAN-PC','MOFG','TRV','FCBC','URR','REAL','NCLH','GCACU','CFR','OCN','DQWS','XELA','RLLT','LGF-A','PMTS','USAC','OMED','PRSC','FMCCO','MITT','GRMC','PEP','GMO','CASI','CBL','XRAY','SINO','PLD','UCO','AVY','IDEX','TRC','WEC','CNO','CBPX','FDEF','LAZY','IHSI','CAG','XAN','ITCC','CCH-UN','BOCH','ABR-PA','YCBD-PA','WHHT','ESE','DBB','VCON','G','MTZ','BWMG','NEBLQ','FREGP','PNPL','SRUP','IDT','KR','HCCC','EMGC','CHKAQ','RSG','BNL','XOMA','OZSC','VTDRF','ATMS','KBRS','CLSN','RBNC','FRGI','BBCP','BBCPW','KMT','ONEW','KWR','PPX','DTE','OTTV','ONTY','FTFT','BCRH','INQD','IPHI','ATGE','AIVI','SNSS','GLD','MCS','PCGU','RGP','PFIN','DE','NVOS','AILLI','NINK','ALNY','FTV','SERV','AGQ','PPL','DLR-PL','PCG-PI','SF-PC','GMBL','ITI','HALL','UUUU-WT','ARP','FLXN','DGTW','NYMTO','AVNI','GLTR','SLAB','EGY','ACBI','SPPI','WLTW','VMW','SSP','DPWW','UMH','CAMP','PBSV','CWGL','SCE-PL','AWX','TILE','TALO','UUUU','SKYW','CCH','J','OFG','MTLQU','HTBI','CTA-PB','DRUA','RSSS','ESCA','CCYCD','SIF','AXL','STRM','TPH','VYST','CSTL','ALRT','RCAR','CUEN','ACNB','JCAP-PB','GALT','AHC','UPLCQ','FREVS','TONJ','BBQ','IVAC','APRE','WFTIQ','CW','MFSF','SFDL','DNO','MRK','ESOA','WELL','BLMT','AZPN','HAWEN','HPE','CY','SF-PA','FRME','RMCF','WCN','AXSM','SURG','ACHV','JMPNL','LMAT','KCAC-UN','INVU','LODE','HDVY','OPXS','CXBS','KOLD','SWP','COTE','AMTX','KNSA','SING','VSH','UPL','AL','AZO','WLMS','ALPP','VOYA','FBP','ACNV','HBANN','BYRN','PG','WTRH','LKCRU','DLOC','HRB','BLMN','GBLIZ','ZIONO','MNR-PC','NVAX','CFBK','DLR-PK','AACH','PENC','FMAO','FIX','DOOR','SIAF','FBIOP','DHR-PA','FMCCI','RHNO','FLT','GS','IMCI','VSPC','ICLD','HCMC','CTXR','FMNB','MNTA','MDIA','NXTD','TIME','RMR','MLM','Z','CROX','NTCT','CNET','VMI','STOR','TUSK','INBKL','BRGO','AERG','UVSP','CYCC','CTRA','IVFH','NEUL','FFWM','BSM','SGMS','SVT','FHN','WWD','IKNX','BHTG','SIMLD','NUVR','DLR-PJ','CNCE','TRXC','RCA','WEAT','OHI','ALTR','CYBE','FHN-PC','PCFP','INCT','CSPR','FMCKM','BRVO','VST','NEPH','YORW','IFFT','SRCO','APTV','EIX','MOBQ','SPB','LFIN','LITE','AGO','GENC','RPRX','UBOH','BWFG','KLIC','IBKR','HPTY','CRBP','ARGQ','PCBK','CTG','HMHC','WTRG','ANGO','CSFL','CIT-PB','BTCY','BBXTD','OMEX','SMTX','STRP','WBT','WRE','HXL','HBI','NBN','SBEV','GLPH','SGEN','RAIL','TAQR','GPAQ','DBD','FOXA','CHKDJ','FMCKI','SHLO','FMCCP','FRLI','PSB','WHLM','WTM','XTEG','SOJB','CBF','SPGI','GXXM','WMGI','FUN','ITIC','LMBHW','ASB-PD','TWNKW','KEGX','ARCH','AKAOQ','FMCCG','SGMA','QUBT','MGY','WHLR','AFI','SEDG','TRMK','BGNE','ZBH','HSNI','AA','CRL','ARR-PC','WCVC','CLOQ','DAR','INS','PAYX','STTH','ATKR','WMC','MOG-B','NSIT','ADAC','ATRA','NWCN','STI','GSG','SIVR','PXPP','HCKT','BIQIF','YTEN','CIVB','OSW','CLLY','SOHO','ARPO','ALV','MRMD','ULE','SNGX','PSA','PSTVZ','SRTS','COP','SENY','OMF','DRI','TIBRU','LFACW','NWPP','CBTX','SFS','PAXH','NEM','DHR','FORR','RTIX','UI','LIQT','LAKE','VYSM','NMGX','CODI-PA','TPNI','T-PC','SBSAA','DHR-PB','BLTN','ESTA','COFS','A','LRDC','FNMAI','AREC','VAPE','PPCB','AFTM','KFRC','COBZ','POTN','AP','BSQR','PNC-PP','FBIO','SNNN','CUB','ROKU','S','KMPH','RELV','HESM','AMRQQ','HQI','LMHB','TWMC','WHLRD','INSW','FLEX','UHAL','SCHN','INVE','BTU','JSHG','PNC-PQ','ISEE','SCO','AGM-A','BHLB','PING','OMAG','TCHC','HPMM','TWTR','RLGT','AMCR','SWAV','SF','RCB','WWR','SFB','CRVS','HWGG','MANT','KDMN','GNTY','FXNC','PVHO','CIEN','AGM-PA','JCTCF','CBAN','CABO','MRTN','BMNM','PSA-PI','ASRV','CKPT','GS-PD','KDP','OPVS','CAT','FMCCL','IOTS','OFED','GNBT','SVBL','SGH','SGA','REFR','SCE-PG','SIML','PIHPP','PETX','EMKR','CLSH','NGLD','PIPR','TRXDW','SPWR','IIN','BHE','MATR','ALL','ETH','HTH','KTEL','MGLN','LABL','IHRC','HON','PSTV','ALTD','PTIE','MTOR','BCOV','AUB','PEGI','HST','RECN','PSA-PX','FOX','TSSI','MSFG','EXTR','ZION','ZN','CHKGQ','WRB-PD','ORNC','PAVMZ','SKVI','COF','OPNT','FSNN','ESTC','XNCR','EPRT','FKYS','TXHG','HTZ','CATO','MKSI','TTD','WISH','JACK','DAKT','DLCR','RNVA','ZYNE','SAVA','STTHD','IPIX','CLNC','BOTY','CRI','SNBC','FCHS','PAVM','PZG','FMCCJ','PRVL','ASB-PF','APLT','NGS','FMCCH','OSK','GMER','FCNCA','NVTR','RRGB','SRGA','APXX','CASA','PAR','FITB','TRHC','PFIE','KCAC-WT','RRD','SHW','ALP-PQ','LGF-B','HLIT','ACUR','COCP','DUK-PA','VEND','RMP','ALE','CSHB','MBCQ','VALU','FITBO','AURX','FJHL','CCNE','NGHCN','HIBB','FNMAJ','PANA-UN','VRNT','VER','NEOG','DVN','HRBR','CGA','WCC-PA','IDIV','DS','DTRC','CCL','NMTC','AAAU','LZGI','ARGO-PA','LRN','PSA-PM','ZIONN','HBMD','RXN','BRQSW','SONM','CPAA','DXC','STKL','BEBE','CHKVQ','PCTI','SCOO','SHLDQ','LZB','SYNA','RCON','ZYME','PSB-PW','GEN','REXR-PB','RARX','CUO','CYCN','GVA','STAY','PH','ISR','ESSI','GLF','WHLRP','EMMS','SNNY','COHU','BIOA','BFRE','LSXMA','BOOT','CIR','FMCCK','DIS','RNR-PF','NTRU','WAL','TEL','CAH','ATIS','BHVN','UBFO','MGYR','RZA','CALI','MDXL','ATOS','SCE-PC','WRLSR','HCAT','CNXR','MYGN','UIHC','ANVI','VIBI','JAG','FMCKO','MBCN','IBCP','INSG','EPAC','SPG-PJ','CUBI-PD','FNAM','CRCM','FNMAM','KKR-PB','BSPK','MS-PA','PMHG','QRON','HCA','T','CBKM','URG','EVER','CKX','IHETW','EQR','GMGI','PHCG','SIRI','URI','TWO-PB','AGHC','RPAY','TIBR','GDSI','QCRH','OREX','PANW','COF-PH','LMT','VPLM','IRBT','IFXY','AXS','ROSE','EV','TCF','THC','DFS','OFG-PB','SIVB','RM','AFGC','BBBY','HRGG','FFBC','TAGS','CRBO','CANE','NERV','BTHE','GFN','JOUT','HWC','FBNK','CFNB','ATVI','STL','CLCN','MS-PL','STLY','MKCV','RBBN','FIBK','HBIA','VIXM','UNOV','NETE','NVEE','AAN','EYEG','JMDA','HAFC','TSLA','CUBI-PF','EMPM','STRO','VISM','AWSM','HBNC','ITGR','MITK','AIRTW','RE','DCP','SPHS','DUKH','ELTP','OII','STAG','USRM','CUI','GRPN','XEL','PTRS','INGR','PACK-WT','SPDL','RCAT','CLVS','VOXX','APT','MLNX','TMBR','AVA','PSB-PY','NRZ','ETM','MS-PE','RJF','WINTD','NHC','ASFT','LOACR','ARKR','CODI-PC','ALSK','NTN','CCYC','TIF','CEQP','WINA','OOIL','ORBC','PSYC','CBT','SFOR','SBOW','FLOW','NLY-PI','WTFC','QMCO','SMTC','RELL','ATHN','HDS','CE','GEVO','TAST','HCYT','MCEP','RRBI','CHK-PD','NBY','LEE','CMTV','AQMS','TCBI','BAX','PRVB','APRDP','WCRS','KLAC','TIS','SKYL','COST','CVGW','CZR','GPFT','ESGR','QDM','BNET','OXY-WT','SWBI','LOGM','FTNT','NGHCP','ALKM','PRU','ARMP','HSIC','DPHC','TAPM','SPWH','UEPEN','ETST','CDOR','GDEN','CHUC','MJTK','WTR','IIIN','TAP','GME','AMSF','GPIC','PSB-PZ','TWO-PC','AMRS','AKR','QLGN','SAMG','MHPC','FREDQ','ARTH','SCE-PE','SYPR','APTO','AIKO','TAP-A','ABC','SHRG','WEX','NLY-PD','KIDS','ENSG','OTRK','FULT','TCCO','NNUP','PSA-PK','BSGM','AGTK','SOJA','MHLD','KKR','PNR','HAWEM','TIPT','CLWD','OILU','PSA-PB','TANNL','USIO','RWT','NGL','NWYU','VYCO','NTIP','CANN','CSCO','PTE','PATK','CUBI','T-PA','GTIM','MAR','TRUE','ENCR','BFA','GVBT','SPRS','ACAN','LMB','MTB','BRG','SNI','CVLY','LCTX','MGEE','WYND','SUM','NCBS','ENDV','CRUS','ANFC','VAC','NUZE','ED','IBM','APXT','UBSI','JMPD','RLLY','JMP','RF','AGNC','CDE','TWO','LAZ','BRLIU','RPM','EUO','KRTX','STT-PG','RGUS','CATS','PSA-PJ','INLXD','WNEB','CTBI','CIDM','LQDT','GLAE','SPLP','LPI','IPAR','DISCB','NYMT','NRZ-PC','TITN','WLH','NE','IMH','ONB','LUVU','QHYG','KKR-PA','MNTX','SCE-PH','BFS','BYIN','GOED','FLSS','AMP','BHOR','HLTY','CCMP','LHCG','USB','GFNSL','FTV-PA','RGR','TJBH','FMCCN','GRTD','LXAM','LENB','LPT','PWR','KEY','NGHCO','TFC-PI','BDR','KMPR','SPG','KO','CATC','FSTR','TRU','RRC','PAHC','INFI','NRZ-PB','CYH','CLBS','PSA-PW','AJG','BSPM','ICUI','DMRC','HOME','ARMK','DTW','NSPR','ACCA','PGEN','DRIO','AIKI','W','SCE-PB','TPR','DEA','UTL','ZBK','GLDD','RC','SUME','SMG','OVV','MTN','MPGR','CRCW','GRNQ','VLGEA','HAWLL','CARV','PLUG','PCYO','IMUX','FBNC','EGLT','ZS','ZIXI','JADG','APXTW','BGSF','SGRY','XENE','NEN','SHBI','AZEK','MPX','IBAL','TLCC','AFINP','H','FFIN','PCG-PB','KEYS','LOGG','NDLS','RGC','RTTR','NLY-PF','VNDA','SFNC','TGTX','EQC-PD','BSFC','PTRC','CVLB','NBEV','CELP','WRLS','AE','NAEX','MKTX','WAFD','MNIQQ','CMRO','CLNY','TRVN','UWN','PSA-PH','ARLP','FTLF','SWTX','MKC','LUB','EIGR','SNMP','GS-PA','WEBK','VIXY','CRHM','SMLP','HL-PB','ALL-PI','AXP','CYTR','AOBC','TBKCP','SNEX','STZB','EE','CYPW','HOG','YUMC','MEME','BNED','SES','AFIN','CPAAU','PRKA','GYRO','WTFCP','CHE','KIN','TCBIL','KCAC','DGX','ABQQ','SCVL','GSFI','STWD','ZCOR','GNBC','ISCO','SMMF','DLPN','PSA-PC','STRA','MS-PF','UONE','PDFS','INAP','ABWN','PJH','CBU','ACM','BBX','ITCI','FLWS','IMGN','XSNX','FDX','ABR-PC','STRZ','SCE-PJ','APO-PA','FHN-PD','INTB','NRG','NAVG','FTK','JRJR','AWGI','EWBC','DCUE','SRCL','JW-A','PEER','HL','ZIONP','YCS','CNR','PRTY','AMCT','PLAG','COMM','GLYE','NVTRQ','WORX','GSC','YBAO','RBNW','CHKPQ','ITP','NYMTM','SPIN','CHUY','QPWR','UDR','AABA','PDLB','ODYY','LNC','ATR','OPTT','EXP','PRLX','HWCPZ','EGLE','MIME','RIG','CUBE','MJNE','FHN-PB','MS-PK','BTN','DFHTU','CLDX','PYPL','BSX-PA','NK','CF','VVUSQ','SYRS','ERI','NVFY','NVGI','ENPH','YCBD','SLOT','CPTP','DKMR','FG','ESPH','TNXP','MSA','MPW','AMMX','QRHC','CNAB','EHC','BKCT','HOMB','VRTC','TXT','JUNO','EL','NTRSO','TNLX','OLBK','POAI','CBZ','FRHC','PLOW','ELVG','ONEM','DREM','NMRX','CRGS','OSBC','GTYH','LAYN','SIG','BLK','VVC','CHSO','SCE-PK','DEST','FORD','VBVT','BHB','AES','THOR','PSNL','YMAB','ROSWQ','USEG','TBRGU','CVO','YCL','IINX','GMGID','AILNP','RDI','GMS','TANNZ','CRS','EPXY','MLI','GNRS','MOG-A','ASB','SHOO','ASB-PE','BFB','PSB-PX','GTVI','PFBI','AOS','JELD','GLXZ','STL-PA','ASTE','NDN','IMAC','PNM','HRL','SPR','CR','PHBI','BRC','NWSA','CLFD','MHLA','PGAI','CWSS','TA','LOAC','PBI','ARMT','UMPQ','INDB','FMCCT','GNE','HUBS','ARI','TIKK','ENZN','QRTEB','PULM','VER-PF','GBLIL','CPSI','CCCP','SSBP','BHC','CZNC','GPAQU','MFNC','CUBI-PC','ARGO','PSA-PF','PHIL','Y','SLNM','STT-PD','MPMQ','FIND','TMQ','SIGM','INIS','CTXRW','CB','SALM','DUK','SWKH','OSIS','PCTY','NYCB','RIVE','CEQP-P','IMUN','QADA','SNDD','BDN','EFX','CYAN','OLN','ELY','IBIO','PEN','HLI','BKIT','IDXG','EA','UEPEM','FSAM','VKIN','AIG-PA','MPAD','IDTY','LFVN','ADMT','ELOX','ACMC','HBUV','FRPH','PDEX','CPLA']

#for ticker in fetch_ticker_list('all_tickers'): 
for ticker in ticker_list: 

    print(ticker)
    update_only = "t" 

    publisher = pubsub_v1.PublisherClient()
    topic_name = 'projects/{project_id}/topics/{topic}'.format(project_id=project_id,topic='download_xbrl_pubsub_topic')
    publisher.publish(topic_name, data=f"{ticker} published".encode('utf-8'), ticker=ticker, update_only=update_only)